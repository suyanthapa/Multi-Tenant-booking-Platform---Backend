// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
}

model Booking {
    id String @id @default(uuid())

    // Ownership
    userId     String @map("user_id")
    vendorId   String @map("vendor_id")
    businessId String @map("business_id")
    resourceId String @map("resource_id")

    // Snapshot data
    businessName   String  @map("business_name")
    resourceName   String  @map("resource_name")
    resourceType   String  @map("resource_type")
    priceAtBooking Decimal @map("price_at_booking") @db.Decimal(10, 2)

    currency String @default("USD")

    // Booking timing
    bookingDate DateTime @map("booking_date")
    startTime   DateTime @map("start_time")
    endTime     DateTime @map("end_time")

    // State
    status BookingStatus @default(PENDING)
    notes  String?

    // Timestamps
    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @updatedAt @map("updated_at")

    // Cancellation
    cancelledAt  DateTime? @map("cancelled_at")
    cancelReason String?   @map("cancel_reason")

    @@index([vendorId])
    @@index([userId])
    @@index([businessId])
    @@index([resourceId])
    @@index([bookingDate])
    @@index([status])
    @@index([resourceId, startTime, endTime]) // overlap checks
    @@map("bookings")
}

enum BookingStatus {
    PENDING
    CONFIRMED
    IN_PROGRESS
    COMPLETED
    CANCELLED
    NO_SHOW
}
